// busybody v0.0.1
// (c) Shane Connon 2015
// http://www.opensource.org/licenses/mit-license.php
(function () {

// orienteer v0.1.0
// (c) Shane Connon 2015
// http://www.opensource.org/licenses/mit-license.php
!function(){function orienteer(){}var a={parents:[],children:[]};orienteer.clearVirtualCache=function(b){if(!b)return a.parents.length=0,void(a.children.length=0);for(var c=0,d=a.children.length;d>c;c++)(a.children[c]===b||a.parents[c]===b)&&(a.children.splice(c,1),a.parents.splice(c,1))},orienteer.useVirtualCache=!0,orienteer.prototype._super=function(){var b=arguments.callee.caller,c=null;if(orienteer.useVirtualCache){var d=a.children.indexOf(b);-1!==d&&(c=a.parents[d])}if(!c){for(var e=[],f=this.constructor.prototype;f;)e.push(f),f=Object.getPrototypeOf(f);e.reverse();for(var g=0,h=e.length;h>g;g++){if(e[g]===b.prototype)c=e[g-1].constructor;else for(var i in e[g]){if(e[g][i]===b)for(var j=g-1;j>=0;j--)if(e[j][i]!==b){c=e[j][i];break}if(c)break}if(c){orienteer.useVirtualCache&&(a.children.push(b),a.parents.push(c));break}}if(!c)throw"Could not find method in parent class"}return c.apply(this,arguments)};orienteer.extend=function(a){if(a.constructor===Function){var b=a;a={constructor:b,statics:{}};for(var c in a.constructor)a.statics[f]=a.constructor[f];for(var c in a.constructor.prototype)a[f]=a.constructor.prototype[f]}else if(a.constructor===Object)a.constructor=function(){this._super.apply(this,arguments)};else if(!a.constructor||a.constructor.constructor!==Function)throw'the property "constructor" must be a function';for(var d in this)this.hasOwnProperty(d)&&this[d]&&this[d].constructor===Function&&this[d]!==orienteer.clearVirtualCache&&this[d]!==orienteer.getInheritanceChain&&void 0===a.constructor[d]&&(a.constructor[d]=this[d]);var e=function(){this.constructor=a.constructor};e.prototype=this.prototype,a.constructor.prototype=new e;for(var f in a)if("constructor"!==f)if("statics"!==f)a.constructor.prototype[f]=a[f];else for(var g in a[f])a.constructor[g]=a[f][g];return a.constructor},orienteer.getInheritanceChain=function(a){for(var b=[];a;)b.push(a),a=Object.getPrototypeOf(a.prototype),a&&(a=a.constructor);return b},window.orienteer=orienteer}();

!function(a){function b(a,b,d,f){return function(g){var h=c.getObserver(a);if(g&&h.$bindingChanges)for(var i in h.$bindingChanges)if(d===h.$bindingChanges[i].fromObject&&g[g.length-1]===h.$bindingChanges[i].change)return;c.captureChanges(d,function(){c.utils.obj.setObject(f,d,c.utils.obj.getObject(b,a))},function(b){c.makeObservable(d);e(b,function(b){var e=c.getObserver(d);if(e){e.$bindingChanges||(e.$bindingChanges={});var f=k();e.$bindingChanges[f]={change:b,fromObject:a},setTimeout(function(){delete e.$bindingChanges[f];for(var a in e.$bindingChanges)return;delete e.$bindingChanges},100)}})})}}var c={},d=c.useObjectObserve=Object.observe&&(!window.hasOwnProperty("useObjectObserve")||window.useObjectObserve),e=function(a,b,c){if(a){c=c||window;for(var d=0,e=a.length;e>d;d++)b.call(c,a[d],d)}},f=function(a,b,c){if(a&&(c=c||window,null!=a))for(var d in a)b.call(c,a[d],d)},g=function(a,b){a=a.split(".");var c=a.splice(0,a.length-1),d={};return d[a[a.length-1]]=b(),h(c.join("."),d),d[a[a.length-1]]},h=function(a,b){if(a=a.split("."),"busybody"!==a[0])throw'Root must be "busybody".';a.splice(0,1);var d=c;e(a,function(a){d=d[a]||(d[a]={})}),b&&b instanceof Function&&(b=b()),f(b,function(a,b){d[b]=a})},i=/^\s+|\s+$/g,j=function(a){return a?a.replace(i,""):a};g("busybody.utils.obj",function(){function a(a,b){b||(b=window);for(var c=0,d=a.length;d>c;c++)if(b=b[a[c]],null==b)return c===d-1?b:null;return b}function b(a,b){a.push(b);var d=new c.disposable(function(){d&&(d=null,b=a.indexOf(b),-1!==b&&a.splice(b,1))});return d}var d=/\[\s*\d\s*\]$/g,g=function(a){a=a.split(".");for(var b,e=0;e<a.length;e++){a[e]=c.utils.obj.trim(a[e]);var f=a[e].match(d);if(f&&f.length){(b=c.utils.obj.trim(a[e].replace(d,"")))?a[e]=c.utils.obj.trim(a[e].replace(d,"")):(a.splice(e,1),e--);for(var g=0,h=f.length;h>g;g++)a.splice(++e,0,parseInt(f[g].match(/\d/)[0]))}}return a},h=function(a){var b=[];return e(a,function(a){b.push(isNaN(a)?0===b.length?a:"."+a:"["+a+"]")}),b.join("")},i=function(b,c){return a(g(b),c)},k=function(b,c,d){var e={};return b=g(b),e.remainder=0>=d?b.splice(b.length+d,-1*d):b.splice(d,b.length-d),e.object=a(b,c,d),e},l=function(b,c,d){b=g(b),b.length>1&&(c=a(b.splice(0,b.length-1),c)),c&&(c[b[0]]=d)},m=function(){};return m.trim=j,m.addWithDispose=b,m.enumerateArr=e,m.enumerateObj=f,m.getObject=i,m.getPartialObject=k,m.setObject=l,m.splitPropertyName=g,m.joinPropertyName=h,m}),g("busybody.disposable",function(){function b(a){a.$disposables||(a.$disposables={})}var c=a.extend(function(a){this._super(),a&&(a instanceof Function?this.registerDisposeCallback(a):this.registerDisposable(a))});return c.prototype.disposeOf=function(a){if(a instanceof Array){var b=!1;return e(a,function(a){b|=this.disposeOf(a)},this),b}return this.$disposables&&this.$disposables[a]?(this.$disposables[a](),delete this.$disposables[a]):!1},c.prototype.disposeOfAll=function(){if(this.$disposables)for(var a in this.$disposables)this.disposeOf(a)},c.prototype.registerDisposeCallback=function(){var a=0;return function(c){if(!c||c.constructor!==Function)throw"The dispose function must be a Function";b(this);var d=(++a).toString();return this.$disposables[d]=c,d}}(),c.prototype.registerDisposable=function(a){if(a){if(a.constructor!==Function||a.dispose||(a=a.call(this)),!(a&&a.dispose instanceof Function))throw"The disposable object must have a dispose(...) function";return this.registerDisposeCallback(a.dispose.bind(a))}},c.prototype.dispose=function(){this.disposeOfAll()},c}),g("busybody.utils.executeCallbacks",function(){var a=c.disposable.extend(function b(){if(this.constructor===b)throw"You cannot create an instance of an abstract class";this._super(),this.callbacks=[]});return a.prototype.addCallback=function(a){var b=c.utils.obj.addWithDispose(this.callbacks,a);return this.registerDisposable(b),b},a.prototype._execute=function(){throw"Abstract methods must be implemented"},a.prototype.execute=function(){var a=this._execute();a&&!a.cancel&&e(this.callbacks.slice(),function(b){b.apply(null,a.arguments||[])})},a.prototype.dispose=function(){this._super(),this.callbacks.length=0},a}),g("busybody.observeTypes.observeTypesBase",function(){var a=c.utils.executeCallbacks.extend(function b(){if(this.constructor===b)throw"You cannot create an instance of an abstract class";this._super()});return a.prototype.getValue=function(){throw"Abstract methods must be implemented"},a.prototype._execute=function(){var a=this.val;return this.val=this.getValue(),{cancel:this.val===a,arguments:[a,this.val]}},a}),g("busybody.observableBase",function(){var a=c.disposable.extend(function(a){this._super(),this.$changeBatch=[],this.$forObject=a,this.$callbacks={}});return a.prototype.registerChangeBatch=function(a){this.$changeBatch.length||setTimeout(this.processChangeBatch.bind(this)),this.$changeBatch.push.apply(this.$changeBatch,a)},a.prototype.processChangeBatch=function(){var b={};e(this.$changeBatch,function(a){b[a.name]||(b[a.name]=[]),b[a.name].push(a)}),this.$changeBatch.length=0,c.utils.observeCycleHandler.instance.execute(this.$forObject||this,function(){var c=[];f(b,function(b,d){this.$callbacks[d]&&c.push.apply(c,a.processChanges(this.$callbacks[d],b))},this),e(c,function(a){a()})}.bind(this))},a.processChanges=function(a,b){var c=[],d=[];e(a,function(a,e){if(a.evaluateOnEachChange)for(var e=0,f=b.length;f>e;e++)a.evaluateSingle(b,e)&&c.push(e);else d.push(function(){a.evaluateMultiple(b)&&c.push(e)})}),c.sort(function(a,b){return b>a});for(var f=0,g=c.length;g>f;f++)a.splice(c[f],1);return d},a.prototype.onNextPropertyChange=function(){throw"Abstract methods must be overridden"},a.prototype.captureChanges=function(a,b,d){if(d&&(d=c.utils.obj.splitPropertyName(d)).length>1)return c.captureChanges(c.utils.obj.getObject(d.slice(0,d.length-1).join("."),this.$forObject||this),a,b,d[d.length-1]);d=d&&d.length?d[0]:void 0;var f=d?function(a){var c=[];e(a,function(a){a.name==d&&c.push(a)}),b(c)}:b.bind(this);return d&&this._init(d),this._captureChanges(a,f)},a.prototype._captureChanges=function(){throw"Abstract methods must be overridden"},a.prototype.bind=function(a,b,d){return c.bind(this,a,b,d)},a.prototype.observeArray=function(a,b,d,e){var f,g,h=this.observe(a,function(a,g){f&&(this.disposeOf(f),f=null);var h={object:g||[],index:0,addedCount:g instanceof Array?g.length:0,removed:a instanceof Array?a:[],type:"splice"};if(e&&e.evaluateOnEachChange)b.call(d,h);else{var i=new c.utils.compiledArrayChange([h],0,1);b.call(d,i.getRemoved(),i.getAdded(),i.getIndexes())}g instanceof c.array&&(f=this.registerDisposable(g.observe(b,d,e)))},this);return(g=c.utils.obj.getObject(a,this.$forObject||this))instanceof c.array&&(f=this.registerDisposable(g.observe(b,d,e))),new c.disposable(function(){f&&(this.disposeOf(f),f=null),h&&(h.dispose(),h=null)})},a.prototype.observe=function(a,b,d,e){if(/[\.\[]/.test(a)){var f=new c.observeTypes.pathObserver(this.$forObject||this,a,b,d);return this.registerDisposable(f),f}this._init(a);var g=new c.callbacks.propertyCallback(b,d,e);this.$callbacks[a]||(this.$callbacks[a]=[]),this.$callbacks[a].push(g),e&&e.activateImmediately?g.activate():this.onNextPropertyChange(a,function(a){g.activate(a)});var h={dispose:function(b){h&&(h=null,b?this.onNextPropertyChange(a,function(a){g.deactivate(a)}):g.deactivate())}.bind(this)};return this.registerDisposable(h),h},a.prototype._init=function(){throw"Abstract methods must be implemented"},a.prototype.dispose=function(){this._super(),delete this.$forObject;for(var a in this.$callbacks)delete this.$callbacks[a]},a.prototype.computed=function(a,b,d){var e=new c.observeTypes.computed(b,this,d);return e.bind(this.$forObject||this,a),this.registerDisposable(e),e},a.prototype.del=function(a){delete(this.$forObject||this)[a]},a.afterObserveCycle=function(a){return c.utils.observeCycleHandler.instance.afterObserveCycle(a)},a.beforeObserveCycle=function(a){return c.utils.observeCycleHandler.instance.beforeObserveCycle(a)},a.afterNextObserveCycle=function(a,b){if(0===c.utils.observeCycleHandler.instance.length&&!b)return void a();var d=c.utils.observeCycleHandler.instance.afterObserveCycle(function(){d.dispose(),a()});return d},a.beforeNextObserveCycle=function(a){var b=c.utils.observeCycleHandler.instance.beforeObserveCycle(function(){b.dispose(),a()});return b},a}),g("busybody.callbacks.changeCallback",function(){var b=a.extend(function(a){this._super(),this.evaluateOnEachChange=a});return b.dispose={},b.prototype.activate=function(a){if(this._activated||this._activatingChange)throw"This callback has been activated";arguments.length?this._activatingChange=a:this._activated=!0},b.prototype.deactivate=function(a){if(this._deactivatingChange)throw"This callback has a deactivate pending";arguments.length?this._deactivatingChange=a:this._activated=!1},b.prototype.evaluateSingle=function(a,c){if(this.evaluateOnEachChange){if(this._activated===!1||this.hasOwnProperty("_deactivatingChange")&&this._deactivatingChange===a[c])return this._activated=!1,b.dispose;if(!this.hasOwnProperty("_activated")){if(!this.hasOwnProperty("_activatingChange")||this._activatingChange!==a[c])return;this._activated=!0,delete this._activatingChange}this._evaluateSingle(a,c)}},b.prototype._evaluateSingle=function(){throw"Abstract methods must be implemented"},b.prototype.evaluateMultiple=function(a){if(!this.evaluateOnEachChange&&a.length){if(this._activated===!1)return b.dispose;var c=0,d=a.length,e=void 0;return this.hasOwnProperty("_activated")||(c=a.indexOf(this._activatingChange),-1!==c&&(this._activated=!0,delete this._activatingChange)),this._deactivatingChange&&(d=a.indexOf(this._deactivatingChange),-1===d?d=a.length:(e=b.dispose,this._activated=!1,delete this._deactivatingChange)),-1!==c&&d>c&&this._evaluateMultiple(a,c,d),e}},b.prototype._evaluateMultiple=function(){throw"Abstract methods must be implemented"},b}),g("busybody.arrayBase",function(){function b(a){return"number"==typeof a&&a%1===0?a:null===a?0:"boolean"==typeof a?a?1:0:"string"!=typeof a||isNaN(a=parseFloat(a))||a%1!==0?void 0:a}var d=a.extend.call(Array,function(a){if(Array.call(this),arguments.length&&!(arguments[0]instanceof Array))throw"The initial values must be an array";if(this.$disposables=[],this.$boundArrays=[],this.$callbacks=[],this.$changeBatch=[],this.$length=a?a.length:0,a)for(var b=0,c=a.length;c>b;b++)this[b]=a[b]});d.prototype._super=a.prototype._super,d.extend=a.extend,d.isValidArrayChange=function(a){return"splice"===a.type||!isNaN(parseInt(a.name))},d.prototype.captureChanges=function(){throw"Abstract methods must be overridden"},d.prototype.onNextArrayChange=function(){throw"Abstract methods must be implemented"},d.prototype.processChangeBatch=function(){var a=this.$changeBatch.slice();this.$changeBatch.length=0,c.utils.observeCycleHandler.instance.execute(this,function(){e(c.observableBase.processChanges(this.$callbacks,a),function(a){a()})}.bind(this))},d.prototype.registerChangeBatch=function(a){for(var b=a.length-1;b>=0;b--)d.isValidArrayChange(a[b])||a.splice(b,1);return c.observableBase.prototype.registerChangeBatch.call(this,a)},Object.defineProperty(d.prototype,"length",{set:function(a){if(void 0===(a=b(a)))throw RangeError("Invalid array length");if(a!==this.$length){if(!this.__alteringArray)if(a>this.$length){var c=new Array(a-this.length+2);c[0]=this.length,c[1]=0,this.splice.apply(this,c)}else a<this.$length&&this.splice(a,this.length-a);this.$length=a}},get:function(){return this.$length}}),d.prototype._init=function(){throw"Abstract methods must be implemented"},d.prototype.observe=function(a,b,d){if("string"==typeof arguments[0]){var e=Array.prototype.slice.call(arguments);return e.splice(0,0,this),c.observe.apply(null,e)}return this.addCallback(new c.callbacks.arrayCallback(a,b,d))},d.prototype.disposableFor=function(a){var b={dispose:function(c){b&&(b=null,c?this.onNextArrayChange(function(b){a.deactivate(b)}):a.deactivate())}.bind(this)};return b};var f="busybody-do-not-apply-to";return d.prototype.alteringArray=function(a,b){if(this.__alteringArray)throw"Calls to alteringArray must be synchronus and not nested.";try{return this.__alteringArray=!0,e(this.$boundArrays,function(c){if(c[f])throw"Circular reference in array bindings found";this[f]!==c&&(c[f]=this,c[a].apply(c,b))},this),Array.prototype[a].apply(this,b)}finally{this.__alteringArray=!1,e(this.$boundArrays,function(a){delete a[f]})}},d.copyAll=function(a,b,c){var d;c?(d=[],e(a,function(a){d.push(c(a))})):d=a.slice(),d.splice(0,0,0,b.length),b.splice.apply(b,d)},d.prototype.bind=function(a){return a&&-1===this.$boundArrays.indexOf(a)?(this.$boundArrays.push(a),a instanceof c.array&&-1!==a.$boundArrays.indexOf(this)||d.copyAll(this,a),new c.disposable(function(){if(a){var b;-1!==(b=this.$boundArrays.indexOf(a))&&this.$boundArrays.splice(b,1),a=null}}.bind(this))):void 0},d.prototype.addCallback=function(a){this._init(),this.$callbacks.push(a),this.onNextArrayChange(function(b){a.activate(b)});var b=this.disposableFor(a);return this.$disposables.push(b),b},d.prototype.dispose=function(){e(this.$disposables,function(a){a.dispose()}),this.$disposables.length=0,this.$boundArrays.length=0,this.$callbacks.length=0},d}),d?g("busybody.array",function(){var a=c.arrayBase.extend(function(){this._super.apply(this,arguments)});return a.prototype.onNextArrayChange=function(a){var b=function(d){if(b)for(var e=0,f=d.length;f>e;e++)if(c.arrayBase.isValidArrayChange(d[e]))return Array.unobserve(this,b),b=null,void a(d[e])}.bind(this);Array.observe(this,b)},a.prototype.captureArrayChanges=function(a,b){var d=function(a){a=a.slice();for(var d=a.length-1;d>=0;d--)c.arrayBase.isValidArrayChange(a[d])||a.splice(d,1);b(a)};Array.observe(this,d),a(),Array.unobserve(this,d)},a.prototype._init=function(){this.__subscription||(this.__subscription=this.registerChangeBatch.bind(this),Array.observe(this,this.__subscription))},a.prototype.dispose=function(){this._super(),this.__subscription&&(Array.unobserve(this,this.__subscription),delete this.__subscription)},a}):g("busybody.array",function(){var a=c.arrayBase.extend(function(){this._super.apply(this,arguments),this.$onNextArrayChanges=[],this.$captureCallbacks=[]});return a.prototype.captureArrayChanges=function(a,b){var d=function(a){a=a.slice();for(var d=a.length-1;d>=0;d--)c.arrayBase.isValidArrayChange(a[d])||a.splice(d,1);b(a)};this.$captureCallbacks.push(d),a(),this.$captureCallbacks.splice(this.$captureCallbacks.indexOf(d),1)},a.prototype.registerChangeBatch=function(a){for(var b=0,d=a.length;d>b;b++)if(c.arrayBase.isValidArrayChange(a[b])){e(this.$onNextArrayChanges.splice(0,this.$onNextArrayChanges.length),function(c){c(a[b])});break}return e(this.$captureCallbacks,function(b){b(a)}),this._super(a)},a.prototype.onNextArrayChange=function(a){this.$onNextArrayChanges.push(a)},a.prototype._init=function(){},a}),function(){var a=c.array;a.prototype.replace=function(a,b){return this.splice(a,a>=this.length?0:1,b),b},a.prototype.pop=function(){return d||this.length&&this.registerChangeBatch([{addedCount:0,index:this.length-1,object:this,removed:[this[this.length-1]],type:"splice"}]),this.alteringArray("pop")},a.prototype.shift=function(){return d||this.length&&this.registerChangeBatch([{addedCount:0,index:0,object:this,removed:[this[0]],type:"splice"}]),this.alteringArray("shift")},a.prototype.remove=function(a){var b;-1!==(b=this.indexOf(a))&&this.splice(b,1)},a.prototype.push=function(){return d||this.registerChangeBatch([{addedCount:arguments.length,index:this.length,object:this,removed:[],type:"splice"}]),this.alteringArray("push",arguments)},a.prototype.reverse=function(){var a=this.length;if(!(2>a)){if(!d){for(var b,c=Math.floor(a/2),e=[],f=0;c>f;f++)e.push({name:f.toString(),object:this,oldValue:this[f],type:"update"}),b=a-f-1,e.push({name:b.toString(),object:this,oldValue:this[b],type:"update"});this.registerChangeBatch(e)}return this.alteringArray("reverse")}},a.prototype.sort=function(){if(!d){for(var a=this.slice(),b=[],c=this.alteringArray("sort",arguments),e=0,f=a.length;f>e;e++)a[e]!==this[e]&&b.push({name:e.toString(),object:this,oldValue:a[e],type:"update"});return this.registerChangeBatch(b),c}return this.alteringArray("sort",arguments)},a.prototype.splice=function(a,b){if(!d){for(var c=[],e=a,f=b+a>this.length?this.length:b+a;f>e;e++)c.push(this[e]);this.registerChangeBatch([{addedCount:arguments.length-2,index:a,object:this,removed:c,type:"splice"}])}return this.alteringArray("splice",arguments)}}(),g("busybody.callbacks.arrayCallback",function(){var a=c.callbacks.changeCallback.extend(function(a,b,c){this._super(c&&c.evaluateOnEachChange),this.useRawChanges=c&&c.useRawChanges,this.callback=a,this.context=b});return a.prototype._evaluateSingle=function(a,b){this.callback.call(this.context,a[b])},a.prototype._evaluateMultiple=function(a,b,d){if(this.useRawChanges)return void this.callback.call(this.context,a.slice(b,d));a.compiled||(a.compiled=[]);for(var e,f=0,g=a.compiled.length;g>f;f++)if(a.compiled[f].areEqual(b,d)){e=a.compiled[f];break}e||a.compiled.push(e=new c.utils.compiledArrayChange(a,b,d)),this._evaluateArrayMultiple(e)},a.prototype._evaluateArrayMultiple=function(a){this.callback.call(this.context,a.getRemoved(),a.getAdded(),a.getIndexes())},a}),g("busybody.callbacks.propertyCallback",function(){var a=c.callbacks.changeCallback.extend(function(a,b,c){this._super(c&&c.evaluateOnEachChange),this.callback=a,this.context=b,this.evaluateIfValueHasNotChanged=c&&c.evaluateIfValueHasNotChanged,this.useRawChanges=c&&c.useRawChanges});return a.prototype._evaluateSingle=function(a,b){var c=a[b],d=a[b+1],e=d?d.oldValue:c.object[c.name];this.useRawChanges?this.callback.call(this.context,c):(this.evaluateIfValueHasNotChanged||e!==c.oldValue)&&this.callback.call(this.context,c.oldValue,e)},a.prototype._evaluateMultiple=function(a,b,c){var d=a[c]?a[c].oldValue:a[0].object[a[0].name];this.useRawChanges?this.callback.call(this.context,a.slice(b,c)):(this.evaluateIfValueHasNotChanged||d!==a[b].oldValue)&&this.callback.call(this.context,a[b].oldValue,d)},a});d?g("busybody.observable",function(){var a=c.observableBase.extend(function(a){this._super(a)});return a.prototype.onNextPropertyChange=function(a,b){var c=function(d){if(c)for(var e=0,f=d.length;f>e;e++)if(d[e].name==a){var g=c;return Object.unobserve(this.$forObject||this,g),c=null,void b(d[e])}}.bind(this);Object.observe(this.$forObject||this,c)},a.prototype._captureChanges=function(a,b){Object.observe(this.$forObject||this,b),a(),Object.unobserve(this.$forObject||this,b)},a.prototype._init=function(){this.__subscribeCallback||(this.__subscribeCallback=this.registerChangeBatch.bind(this),Object.observe(this.$forObject||this,this.__subscribeCallback))},a.prototype.dispose=function(){this._super(),this.__subscribeCallback&&(Object.unobserve(this.$forObject||this,this.__subscribeCallback),delete this.__subscribeCallback)},a}):g("busybody.observable",function(){function a(a){return a.$observer||a}var b=c.observableBase.extend(function(a){this._super(a),this.$observed={},this.$onNextPropertyChanges={},this.$captureCallbacks=[]});return b.prototype.onNextPropertyChange=function(a,b){(this.$onNextPropertyChanges[a]||(this.$onNextPropertyChanges[a]=[])).push(b)},b.prototype._captureChanges=function(a,b){this.$captureCallbacks.push(b),a(),this.$captureCallbacks.splice(this.$captureCallbacks.indexOf(b),1)},b.prototype._init=function(b){this.$observed.hasOwnProperty(b)||((this.$forObject||this).hasOwnProperty(b)&&(this.$observed[b]=(this.$forObject||this)[b]),Object.defineProperty(this.$forObject||this,b,{get:function(){return a(this).$observed[b]},set:function(c){var d=a(this),f={type:d.$observed.hasOwnProperty(b)?"update":"add",name:b,object:this,oldValue:d.$observed[b]};if(d.$observed[b]=c,d.$onNextPropertyChanges[b]){var g=d.$onNextPropertyChanges[b];delete d.$onNextPropertyChanges[b],setTimeout(function(){e(g,function(a){a(f)})})}d.addChange(f)},enumerable:!0,configurable:!0}))},b.prototype.addChange=function(a){this.__changeToken||(this.__changeToken=[],setTimeout(function(){var a=this.__changeToken;delete this.__changeToken,this.registerChangeBatch(a)}.bind(this))),this.__changeToken.push(a),e(this.$captureCallbacks,function(b){b([a])})},b.prototype.del=function(a){(this.$forObject||this)[a]=void 0,this._super(a)},b.prototype.dispose=function(){this._super();for(var a in this.$onNextPropertyChanges)delete this.$onNextPropertyChanges[a]},b});g("busybody.observeTypes.computed",function(){var a=/\s*with\s*\(/g,b=/([^\s,]+)/g,d=/\/\/.*$/gm,f=/\/\*[\s\S]*?\*\//gm,g="((\\s*\\.\\s*([\\w\\$]*))|(\\s*\\[\\s*\\d\\s*\\]))+",h={},i=c.observeTypes.observeTypesBase.extend(function l(a,c,d){if(this._super(),d=d||{},this.arguments=[],d.observeArrayElements&&(this.possibleArrays=[]),this.callbacks=[],this.callbackString=l.stripFunction(a),this.callbackFunction=a,this.context=c,!d.allowWith&&l.testForWith(this.callbackString))throw'You cannot use the "with" keyword in computed functions by default. To allow "with", use the allowWith flag on the options argument of the constructor, however, properties of the variable within the "with" statement cannot be monitored for change.';var f=this.callbackString.slice(this.callbackString.indexOf("(")+1,this.callbackString.indexOf(")")).match(b)||[];if(d.watchVariables&&f.length){var g;for(var i in d.watchVariables)-1!==(g=f.indexOf(i))&&(this.arguments[g]=d.watchVariables[i],f[g]=h)}if(e(f,function(a){if(a!==h)throw'Argument "'+a+'" must be added as a watch variable.'}),this.watchVariable("this",c,d.observeArrayElements),d.watchVariables)for(var i in d.watchVariables)this.watchVariable(i,d.watchVariables[i],d.observeArrayElements);d.delayExecution||this.execute()});i.testForWith=function(b){for(a.lastIndex=0;a.exec(b);)if(!/[\.\w\$]/.test(b[a.lastIndex-1]))return!0;return!1},i.prototype.rebuildArrays=function(){e(this.possibleArrays,function(a){a.disposeKeys&&a.disposeKeys.length&&(this.disposeOf(a.disposeKeys),a.disposeKeys.length=0);var b=a.path.length?c.utils.obj.getObject(a.path,a.root):a.root;b instanceof Array&&(a.disposeKeys=a.disposeKeys||[],e(b,function(b){e(a.subPaths,function(c){a.disposeKeys.push(this.addPathWatchFor(b,c))},this)},this))},this)},i.prototype.getValue=function(){return this.possibleArrays&&this.rebuildArrays(),this.callbackFunction.apply(this.context,this.arguments)},i.prototype.bind=function(a,b){var c=i.createBindFunction(a,b),d=this.onValueChanged(c,!0);return d.registerDisposable(c),d},i.prototype.onValueChanged=function(a,b){var c=this.addCallback(a);return b&&a(void 0,this.val),c},i.stripFunction=function(a){a=a.toString().replace(d,"").replace(f,"");for(var b=/["']/g;b.exec(a);){var c="'"===a[b.lastIndex-1]?/'/g:/"/g;for(c.lastIndex=b.lastIndex;c.exec(a);){for(var e=0,g=c.lastIndex-2;"\\"===a[g];g--)e++;if(e%2===0){a=a.substr(0,b.lastIndex-1)+"#"+a.substr(c.lastIndex);break}}}return a},i.prototype.examineVariable=function(a,b){if(a=j(a),!/^[\$\w]+$/.test(a))throw"Invalid variable name. Variable names can only contain 0-9, a-z, A-Z, _ and $";for(var c,d,e,f,h=[],i=a.replace("$","\\$"),k=new RegExp((b?"(":"")+i+g+(b?")|"+i:""),"g"),l=[];null!==(c=k.exec(this.callbackString));)if(e=k.lastIndex-c[0].length,-1===(f=l.indexOf(d=c[0].replace(/\s/g,"")))||b){if(e>0){if(-1!==this.callbackString[e-1].search(/[\w\$]/))continue;for(var m=e-1;m>=0;m--){if("."===this.callbackString[m]){d=null;break}if(0!==this.callbackString[m].search(/\s/))break}}null!==d&&(-1===f&&(l.push(d),f=h.length,h.push({variableName:d,complexResults:[]})),b&&h[f].complexResults.push({name:c[0],index:e}))}return h},i.prototype.watchVariable=function(a,b,d){var f,g,h=this.examineVariable(a,d);e(h,function(a){if(f=c.utils.obj.splitPropertyName(a.variableName),f.length>1&&this.addPathWatchFor(b,c.utils.obj.joinPropertyName(f.slice(1))),d){var h;e(a.complexResults,function(a){(g=this.examineArrayProperties(a.name,a.index))&&(h?h.subPaths.push(g):this.possibleArrays.push(h={root:b,path:c.utils.obj.joinPropertyName(f.slice(1)),subPaths:[g]}))},this)}},this)};var k=new RegExp("^\\s*\\[\\s*[\\w\\$]+\\s*\\]\\s*"+g);return i.prototype.examineArrayProperties=function(a,b){var c;return(c=k.exec(this.callbackString.substr(b+a.length)))?(c=c[0].substr(c[0].indexOf("]")+1).replace(/\s/g,""),"."===c[0]?c.substring(1):c):void 0},i.prototype.addPathWatchFor=function(a,b){var d,b=new c.observeTypes.pathObserver(a,b,this.execute,this),e=this.execute.bind(this);return b.onValueChanged(function(a,b){d&&(d.dispose(),d=null),b instanceof c.array&&(d=b.observe(e))},!0),this.registerDisposable(b)},i.createBindFunction=function(a,b){var d,e=function(f,g){var h=c.utils.obj.getObject(b,a);g!==h&&(e.dispose(),g instanceof Array||h instanceof Array?d=c.tryBindArrays(g,h):c.utils.obj.setObject(b,a,g))};return e.dispose=function(){d&&(d.dispose(),d=null)},e},i}),g("busybody.observeTypes.pathObserver",function(){var a=c.observeTypes.observeTypesBase.extend(function(a,b,d,e){this._super(),this.forObject=a,this.property=b,this.path=c.utils.obj.splitPropertyName(b),this.__pathDisposables=new Array(this.path.length),this.execute(),this.buildObservableChain(),this.init=!0,this.callbacks=[],d&&this.onValueChanged(d.bind(e||a),!1)});return a.prototype.onValueChanged=function(a,b){var c=this.addCallback(a);return b&&a(void 0,this.val),c},a.prototype.buildObservableChain=function(a){a=a||0;for(var b=a;b<this.path.length;b++)this.__pathDisposables[b]&&(this.__pathDisposables[b].dispose(),this.__pathDisposables[b]=null);var d=this.forObject,e=this;for(b=0;d&&a>b;b++)d=d[this.path[b]];for(;d&&b<this.path.length-1;b++){if((c.canObserve(d)||d instanceof c.array)&&d[this.path[b]]&&b>=a){var f=[d,function(a){return function(){e.buildObservableChain(a),e.execute()}}(b)];isNaN(this.path[b])&&f.splice(1,0,this.path[b]),this.__pathDisposables[b]=c.tryObserve.apply(null,f)}d=d[this.path[b]]}c.canObserve(d)&&(this.__pathDisposables[b]=c.tryObserve(d,this.path[b],function(){this.execute()},this))},a.prototype.getValue=function(){for(var a=this.forObject,b=0,c=this.path.length;null!=a&&c>b;b++)a=a[this.path[b]];return b===c?a:null},a.prototype.dispose=function(){this._super();for(var a=0,b=this.__pathDisposables.length;b>a&&this.__pathDisposables[a];a++)this.__pathDisposables[a]&&this.__pathDisposables[a].dispose();this.__pathDisposables.length=0},a}),g("busybody.utils.compiledArrayChange",function(){function a(a,b,c){this.beginAt=b,this.endAt=c,this.changes=[],this.build(a)}return a.prototype.buildIndexes=function(){if(!this.indexes){var a,b,c=[],d=[],f=[],g=[],h=[],i=[],j=this.added.slice();e(this.finalArray,function(b,c){(c>=this.beginArray.length||b!==this.beginArray[c])&&(-1!==(a=j.indexOf(b))?(g.push({value:b,index:c}),j.splice(a,1)):f[c]=b)},this);var k=this.removed.slice();e(this.beginArray,function(b,e){(e>=this.finalArray.length||b!==this.finalArray[e])&&(-1!==(a=k.indexOf(b))?(h.push({value:b,index:e}),k.splice(a,1)):(c.push(b),d.push(e)))},this);for(var l={};c.length;)a=c.shift(),b=f.indexOf(a),f[b]=l,i.push({value:a,from:d.shift(),to:b});this.indexes={moved:i,added:g,removed:h}}},a.prototype.build=function(a){if(this.removed=[],this.added=[],!a.length||this.beginAt>=this.endAt)return void(this.indexes={added:[],removed:[],moved:[]});for(var b,c,d,f,g=a[0].object.slice(),h=a.length-1;h>=this.beginAt;h--)b="splice"===a[h].type?a[h]:{addedCount:1,index:parseInt(a[h].name),removed:[a[h].oldValue]},h<this.endAt&&(this.finalArray||(this.finalArray=g.slice()),f=0,e(b.removed,function(a){-1===(d=this.added.indexOf(a))?(this.removed.splice(f,0,a),f++):this.added.splice(d,1)},this),f=0,e(g.slice(b.index,b.index+b.addedCount),function(a){-1===(d=this.removed.indexOf(a))?(this.added.splice(f,0,a),f++):this.removed.splice(d,1)},this),this.changes.splice(0,0,{index:b.index,added:g.slice(b.index,b.index+b.addedCount),removed:b.removed,change:a[h]})),c=b.removed.slice(),c.splice(0,0,b.index,b.addedCount),g.splice.apply(g,c);this.beginArray=g.slice()},a.prototype.areEqual=function(a,b){return this.beginAt===a&&this.endAt===b},a.prototype.getRemoved=function(){return this.removed.slice()},a.prototype.getAdded=function(){return this.added.slice()},a.prototype.getIndexes=function(){return this.indexes||this.buildIndexes(),{added:this.indexes.added.slice(),removed:this.indexes.removed.slice(),moved:this.indexes.moved.slice()}},a}),g("busybody.utils.observeCycleHandler",function(){function a(a){a()}var b=c.observable.extend(function(){this._super(),this.$afterObserveCycles=[],this.$beforeObserveCycles=[],this.length=0,this.observe("length",function(b,c){0===c&&e(this.$afterObserveCycles.slice(),a)},this,{evaluateOnEachChange:!1,evaluateIfValueHasNotChanged:!0})});return b.prototype.execute=function(a,b){try{this.before(a),b()}finally{this.after(a)}},b.prototype.before=function(b){b!==this&&(0===this.length&&e(this.$beforeObserveCycles.slice(),a),this.length++)},b.prototype.clear=function(){this.length>0&&(this.length=0)},b.prototype.after=function(a){a===this||this.length<=0||this.length--},b.prototype.afterObserveCycle=function(a){return c.utils.obj.addWithDispose(this.$afterObserveCycles,a)},b.prototype.befreObserveCycle=function(a){return c.utils.obj.addWithDispose(this.$beforeObserveCycles,a)},b.prototype.dispose=function(){this._super(),this.$afterObserveCycles.length=0,this.$beforeObserveCycles.length=0},b.instance=new b,b}),c.getObserver=function(a){return null==a||a instanceof c.observableBase?a:a.$observer instanceof c.observableBase?a.$observer:null},c.captureArrayChanges=function(a,b,d){if(!(a instanceof c.array))throw"Only busybody.array objects can have changes captured";return a.captureArrayChanges(b,d)},c.captureChanges=function(a,b,d,e){return(a=c.getObserver(a))?a.captureChanges(b,d,e):void b()},c.makeObservable=function(a){if(arguments.length||(a={}),a instanceof c.array){if(c.getObserver(a))return a}else if(c.canObserve(a))return a;if(a.$observer)throw"The $observer property is reserved";return Object.defineProperty(a,"$observer",{enumerable:!1,configurable:!1,value:new c.observable(a),writable:!1}),a},c.observe=function(a,b,d,e,f,g){return c.makeObservable(a),c.tryObserve(a,b,d,e,f,g)},c.tryObserve=function(a,b,d,e,f){if(a instanceof c.array){if(b instanceof Function)return a.observe(arguments[1],arguments[2],arguments[3]);"length"===b&&(b="$length"),c.makeObservable(a)}var g=c.getObserver(a);return g?g.observe(b,d,e,f):!1},c.observeArray=function(a,b,d,e,f){return c.makeObservable(a),c.tryObserveArray(a,b,d,e,f)},c.tryObserveArray=function(a,b,d,e,f){var g=c.getObserver(a);return g?g.observeArray(b,d,e,f):!1},c.tryBindArrays=function(a,b){if(!(a instanceof Array)&&null!=a||!(b instanceof Array)&&null!=b)throw"You cannot bind a value to an array. Arrays can only be bound to other arrays.";if(null!=a||null!=b)if(null==a)b.length=0;else if(null!=b){if(a instanceof c.array)return a.bind(b);c.array.copyAll(a,b)}};var k=function(){var a=0;return function(){return"ch-"+ ++a}}();c.tryBind=function(a,d,e,f,g,h){function i(){j&&(l.disposseOf(j),disp=null);var g=c.utils.obj.getObject(d,a),i=c.utils.obj.getObject(f,e);g instanceof Array||i instanceof Array?j=l.registerDisposable(c.tryBindArrays(g,i)):h?h=void 0:(k||(k=b(a,d,e,f))).apply(this,arguments)}var j,k,l=new c.disposable;return l.registerDisposable(c.tryObserve(a,d,i,null,{useRawChanges:!0})),i(),g&&l.registerDisposable(c.tryBind(e,f,a,d,!1,!0)),l},c.bind=function(a,b,d,e,f){return c.makeObservable(a),c.makeObservable(d),c.tryBind(a,b,d,e,f)},c.canObserve=function(a){return a instanceof c.array||!!c.getObserver(a)},c.del=function(a,b){var d=c.getObserver(a);return d?d.del(b):void 0},c.dispose=function(a){var b=c.getObserver(a);return b?b.dispose():void 0},window.bb=c}(window.orienteer);

}())